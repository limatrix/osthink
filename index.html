<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OSThink</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <script src="./js/jquery.min.js"></script>
    <style type="text/css">
        body {
            font-size: 18px;
            line-height: 1.42857143;
        }

        .cursor {
            cursor: pointer;
        }

        .answer-content {
            width: 100%;
            padding: 12px 5px 0px 5px;
            border-bottom: 1px solid #dddddd;
        }

        p {
            margin: 0 0 0 0;
            font-size: 14px;
        }

        .time {
            text-align: right;
            font-size: 12px;
            color: #3e3e3e;
        }
    </style>
</head>
<body>

<div class="container" style="padding-top: 20px;">
  <div id="question-list">
    <div class="list-group">
    </div>
    <input type="text" class="form-control" id="newq" placeholder="增加问题">
    <button type="button" class="btn btn-success" id="addq" style="width:100%">增加</button>
  </div>
  <div id="answer-edit" style="display: none;">
      <textarea id="answer-text" style="width: 100%; height: 768px;"></textarea>
      <button type="button" class="btn btn-success" id="add-answers" style="width:100%">增加</button>
  </div>  
  <div id="answer-all" style="width: 100%; display: none;">

  </div>
</div>
<script type="text/javascript">
    Date.prototype.formatNormalTime = function() {
        function full(num) {
            return (num < 10) ? ("0"+num) : num;
        }
        var year = this.getFullYear();
        var month = full(this.getMonth() + 1);
        var day = full(this.getDate());
        var hour = full(this.getHours());
        var minute = full(this.getMinutes());
        var second = full(this.getSeconds());

        return year + "-" + month + "-" + day + " " + hour + ":" + minute + ":" + second;
    };

    var c = (new Date()).formatNormalTime();
    console.log(c)

    var Question = function() {
        this.storage = window.localStorage;
        this.curseq = 1;
        this.prefix = "question-";
        this.curseqkey = this.prefix + "curseq";
        this.qlist = [];
        this.initSeq();
        this.initQuestion();
    }

    Question.prototype = {
        initSeq : function() {
            var curseq = this.getItem(this.curseqkey);
            if(!curseq) {
                this.setItem(this.curseqkey, this.curseq);
            } else {
                this.curseq = Number(curseq) + 1;
            }
            console.log(this.curseq);
        },

        initQuestion : function () {
            for (var i = 1; i < this.curseq; i++) {
                var key = this.prefix + i;
                var question = this.getItem(key);
                var obj = {
                    "seq" : i,
                    "value" : question,
                }
                this.qlist.push(obj);
            }
        },

        getQuestion : function() {
            return this.qlist;
        },

        incrCurSeq : function() {
            this.setItem(this.curseqkey, this.curseq);
            this.curseq++;
        },

        getItem : function(key) {
            return this.storage.getItem(key);
        },

        setItem : function(key, value) {
            return this.storage.setItem(key, value);
        },

        getCurSeq : function() {
            return this.curseq;
        },

        add : function(seq, value) {
            var key = this.prefix + seq;
            this.setItem(key, value);
            this.incrCurSeq();
        }

    };
    // end question

    var Answer = function(questionSeq) {
        this.storage = window.localStorage;
        this.curseq = 1;
        this.prefix = "answer-" + questionSeq + "-";
        this.curseqkey = this.prefix + "curseq";
        this.questionSeq = questionSeq;
        this.alist = [];
        this.initSeq();
    }

    Answer.prototype = {
        initSeq : function() {
            var curseq = this.getItem(this.curseqkey);
            if(!curseq) {
                this.setItem(this.curseqkey, this.curseq);
            } else {
                this.curseq = Number(curseq) + 1;
            }
            console.log(this.curseq);
        },

        getItem : function(key) {
            return this.storage.getItem(key);
        },

        setItem : function(key, value) {
            return this.storage.setItem(key, value);
        },

        incrCurSeq : function() {
            this.setItem(this.curseqkey, this.curseq);
            this.curseq++;
        },

        add : function(value) {
            var key = this.prefix + this.curseq;
            var date = new Date();
            var obj = {
                "mil" : date.getTime(),
                "date" : date.formatNormalTime(),
                "value" : value,
            };
            this.setItem(key, JSON.stringify(obj));
            this.incrCurSeq();
        },

        getAll : function() {
            for (var i = 1; i < this.curseq; i++) {
                var value = this.getItem(this.prefix + i);
                this.alist.push(value);
            }

            return this.alist;
        }
    };

    var q = new Question();
    var global_seq = 0;
    
    /////////
    function addQuestion2Doc(seq, value) {
        var listSubClass = ( seq % 2 == 0) ? "success" : "info";
        var str = '<div class="list-group-item list-group-item-' + listSubClass + '">' + 
                  '<span class="question cursor" seq="' + seq + '">' + 
                  value +'</span><span class="badge cursor" seq="' + seq + '">All</span></div>';
        
        $(".list-group").append(str);
    }

    function bindQuestionAdd() {
        $("#addq").click(function(){
            var newq = $("#newq");
            var seq = q.getCurSeq();
            var value = newq.val();
            newq.val("");
            addQuestion2Doc(seq, value);
            q.add(seq, value);
        });
    }

    function bindQuestion() {
        $("#question-list").on("click", ".question", function(){
            var seq = $(this).attr("seq");
            global_seq = Number(seq);
            console.log(seq);
            showAnswerEdit();
        });
    }

    function addAnswer2Doc(data) {
        str = '<div class="answer-content"><p>' + data.value +'</p>' + 
              '<p class="time">' + data.date + '</p></div>';
        $("#answer-all").append(str);
    }

    function bindQuestionAll() {
        $("#question-list").on("click", ".badge", function(){
            $("#question-list").hide();
            $("#answer-all").show();
            var seq = $(this).attr("seq");
            global_seq = Number(seq);
            console.log(global_seq);
            var a = new Answer(global_seq);
            var list = a.getAll();

            for (var i = 0; i < list.length; i++) {
                addAnswer2Doc(JSON.parse(list[i]));
            }


            console.log(list);

        });
    }

    function showQuestionList() {
        $("#question-list").show();
        $("#answer-edit").hide();
    }

    function showAnswerEdit() {
        $("#question-list").hide();
        $("#answer-edit").show();
    }

    function bindAnswerAdd() {
        $("#add-answers").click(function(){
            showQuestionList();
            var a = new Answer(global_seq);
            a.add($("#answer-text").val());
            $("#answer-text").val("");
        });
    }
    
    $(document).ready(function(){
        var qlist = q.getQuestion();
        for (var i = 0; i < qlist.length; i++) {
            addQuestion2Doc(qlist[i].seq, qlist[i].value);
        }

        bindQuestionAdd();
        bindQuestion();
        bindAnswerAdd();
        bindQuestionAll();
        console.log(qlist);
    });


    // localstorage
    



</script>
</body>
</html>

      <!-- <a href="#" class="list-group-item active">
        Cras justo odio
      </a> -->
